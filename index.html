<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Caelan Frameworks - Business by Ar3sDevelopment</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Caelan Frameworks - Business</h1>
          <h2>Caelan.Frameworks.BIZ NuGet Package</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/Ar3sDevelopment/Caelan.Frameworks.BIZ/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/Ar3sDevelopment/Caelan.Frameworks.BIZ/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/Ar3sDevelopment/Caelan.Frameworks.BIZ" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a id="caelanframeworksbiz-nuget-package" class="anchor" href="#caelanframeworksbiz-nuget-package" aria-hidden="true"><span class="octicon octicon-link"></span></a>Caelan.Frameworks.BIZ NuGet Package</h1>

<h2>
<a id="what-is-it" class="anchor" href="#what-is-it" aria-hidden="true"><span class="octicon octicon-link"></span></a>What is it?</h2>

<p>This package provides some utilities for the business layer like repositories and units of work.</p>

<h2>
<a id="irepository" class="anchor" href="#irepository" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>IRepository</code>
</h2>

<p>The <code>IRepository</code> interface is the base interface of Repositories used in this framework. It has two methods for getting the linked <code>IUnitOfWork</code> instance.
<code>IRepository</code> has two methods because you can get a generic <code>IUnitOfWork</code> or a custom <code>UnitOfWork</code> type.</p>

<h3>
<a id="repository" class="anchor" href="#repository" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>Repository</code>
</h3>

<p>The <code>Repository</code> class implements <code>IRepository</code> interface and has a static method for fluent notation for getting a <code>Repository&lt;TEntity, TDTO&gt;</code> specifying only <code>TEntity</code> and <code>TDTO</code>
This class is abstract because I thought that is useless for other uses.</p>

<h3>
<a id="irepositorytentity-tdto" class="anchor" href="#irepositorytentity-tdto" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>IRepository&lt;TEntity, TDTO&gt;</code>
</h3>

<p>The <code>IRepository&lt;TEntity, TDTO&gt;</code> interface inherits from <code>IRepository</code> and has more methods than its base and they're business related like basic CRUD operations.
<code>IRepository&lt;TEntity, TDTO&gt;</code> has also a method for return paginated result.</p>

<h4>
<a id="repositorytentity-tdto" class="anchor" href="#repositorytentity-tdto" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>Repository&lt;TEntity, TDTO&gt;</code>
</h4>

<p>The <code>Repository&lt;TEntity, TDTO&gt;</code> inherits from <code>Repository</code> and implements <code>IRepository&lt;TEntity, TDTO&gt;</code> interface with some <code>EntityFramework</code> code for doing CRUD operations.
If you need some custom methods you can inherit from <code>Repository&lt;TEntity, TDTO&gt;</code> and use all the business ready methods.
Supposing you need a method to get if a user is admin:</p>

<div class="highlight highlight-csharp"><pre><span class="pl-s">public</span> <span class="pl-st">bool</span> IsAdmin(<span class="pl-st">int</span> id)
{
  <span class="pl-k">var</span> user = SingleEntity(id);
  <span class="pl-k">return</span> user != <span class="pl-c1">null</span> ? user.Admin : <span class="pl-c1">false</span>;
}</pre></div>

<p>Or if you need a method that return all admin users:</p>

<div class="highlight highlight-csharp"><pre><span class="pl-s">public</span> IEnumerable&lt;UserDTO&gt; AllAdmins()
{
  <span class="pl-k">return</span> List(t =&gt; t.Admin); <span class="pl-c">//DTOs</span>
}

<span class="pl-s">public</span> IEnumerable&lt;User&gt; AllAdminsEntities()
{
  <span class="pl-k">return</span> All(t =&gt; t.Admin);
}

<span class="pl-c">//using builders from my Common Framework</span>
<span class="pl-s">public</span> IEnumerable&lt;User&gt; AllAdminsEntities()
{
  <span class="pl-k">return</span> DTOBuilder().BuildList(AllAdminsEntities());
}</pre></div>

<p>Last solution is preferred because you can methods that returns subset of records and when you need DTOs you can simply build them with provided <code>Builder</code>s methods: <code>DTOBuilder()</code> for Entity to DTO mappings and <code>EntityBuilder()</code> for DTO to Entity mappings.
They use <code>Builder</code> class from my Common framework.</p>

<p>The paginated result uses method All with pagination parameters. It returns a <code>DataSourceResult</code>, that can also be used in WCF, with the page record and the total. <code>Sort</code> and <code>Filter</code> classes are in my DynamicLinq framework and contains data for sorting and filtering data for the page you need.</p>

<h4>
<a id="ilistrepositorytentity-tdto-tlistdto" class="anchor" href="#ilistrepositorytentity-tdto-tlistdto" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>IListRepository&lt;TEntity, TDTO, TListDTO&gt;</code>
</h4>

<p>The <code>IListRepository&lt;TEntity, TDTO, TListDTO&gt;</code> is an interface that inherits from <code>IRepository&lt;TEntity, TDTO&gt;</code> and has only one get-set property for another <code>IRepository</code> but for <code>TEntity</code> and <code>TListDTO</code> so you can have two DTO for the same type, one lighter for reading lists of DTOs and one complete for CRUD operations.
I use it when I have to return data using WCF and data must navigate deep inside objects.</p>

<h2>
<a id="iunitofwork" class="anchor" href="#iunitofwork" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>IUnitOfWork</code>
</h2>

<p>The <code>IUnitOfWork</code> interface contains base methods for the <code>UnitOfWork</code> like transactions, save changes and getting repositories.</p>

<h3>
<a id="unitofwork" class="anchor" href="#unitofwork" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>UnitOfWork</code>
</h3>

<p>There are two <code>UnitOfWork</code> classes, one wants <code>DbContext</code> in constructor, the other inherits from this and wants only the <code>DbContext</code> type and instantiate it with default constructor.
<code>UnitOfWork</code> implements the <code>IDisposable</code> interface so you can use it in the <code>using</code> closure and it disposes the context only if it's instatiated by the <code>UnitOfWork</code> otherwise you will be responsible for it.
<code>UnitOfWork</code> class, like <code>Builder</code>, uses reflection for getting <code>IRepository</code> objects that are unknown. You can get the repository in two ways:</p>

<div class="highlight highlight-csharp"><pre><span class="pl-k">using</span> (<span class="pl-k">var</span> uow = <span class="pl-s">new</span> UnitOfWork&lt;TestDbContext&gt;()) <span class="pl-c">//the uow object is responsible for disposing the context</span>
{
  <span class="pl-s">const</span> <span class="pl-st">int</span> id = <span class="pl-c1">1</span>;
  <span class="pl-k">var</span> user = uow.Repository&lt;User, UserDTO&gt;().SingleDTO(id);
  <span class="pl-k">if</span> (user != <span class="pl-c1">null</span> &amp;&amp; uow.Repository&lt;UserRepository&gt;().IsAdmin(user.Id))
  {
    <span class="pl-c">//user is admin</span>
  }
  <span class="pl-k">else</span> <span class="pl-k">if</span> (user != <span class="pl-c1">null</span>)
  {
    <span class="pl-c">//user exists but is not admin</span>
  }
  <span class="pl-k">else</span>
  {
    <span class="pl-c">//user not found</span>
  }
}</pre></div>

<p>The <code>user</code> object is retrieved by <code>IRepository&lt;TEntity, TDTO&gt;</code> exposed methods because the repository type is not known at compile time. We can check the admin status by retrieving the repository by type so we know it at compile time and we can use its business related methods like <code>IsAdmin</code>.</p>

<h3>
<a id="iunitofworkcallertunitofwork" class="anchor" href="#iunitofworkcallertunitofwork" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>IUnitOfWorkCaller&lt;TUnitOfWork&gt;</code>
</h3>

<p>The <code>IUnitOfWorkCaller&lt;TUnitOfWork&gt;</code> interface contains methods for a class that performs lambda expressions on a <code>UnitOfWork</code></p>

<h4>
<a id="unitofworkcaller" class="anchor" href="#unitofworkcaller" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>UnitOfWorkCaller</code>
</h4>

<p><code>UnitOfWorkCaller</code> is a static class for fluently accessing to a <code>IUnitOfWork</code>: one by <code>DbContext</code> and you get a simple <code>IUnitOfWork</code> or one by <code>IUnitOfWork</code> and you get all custom methods you have customized.</p>

<p>This class helps writing code because you have not to worry about creating and disposing <code>UnitOfWork</code> or <code>DbContext</code> objects.</p>

<p>Previous <code>UnitOfWork</code> code can be written like:</p>

<div class="highlight highlight-csharp"><pre>UnitOfWorkCaller.Context&lt;TestDbContext&gt;().UnitOfWork(uow =&gt;
{
  <span class="pl-s">const</span> <span class="pl-st">int</span> id = <span class="pl-c1">1</span>;
  <span class="pl-k">var</span> user = uow.Repository&lt;User, UserDTO&gt;().SingleDTO(id);
  <span class="pl-k">if</span> (user != <span class="pl-c1">null</span> &amp;&amp; uow.Repository&lt;UserRepository&gt;().IsAdmin(user.Id))
  {
    <span class="pl-c">//user is admin</span>
  }
  <span class="pl-k">else</span> <span class="pl-k">if</span> (user != <span class="pl-c1">null</span>)
  {
    <span class="pl-c">//user exists but is not admin</span>
  }
  <span class="pl-k">else</span>
  {
    <span class="pl-c">//user not found</span>
  }
});</pre></div>

<p>If you need a return value from this lamda simply return it, it automatically returns it to the expression value.</p>
        </section>

        <footer>
          Caelan Frameworks - Business is maintained by <a href="https://github.com/Ar3sDevelopment">Ar3sDevelopment</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>