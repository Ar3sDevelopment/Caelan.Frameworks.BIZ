<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Business Framework : The Caelan.Frameworks.BIZ NuGet Package">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Business Framework</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/Ar3sDevelopment/UnitOfWork.NET">View on GitHub</a>

          <h1 id="project_title">Business Framework</h1>
          <h2 id="project_tagline">The Caelan.Frameworks.BIZ NuGet Package</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/Ar3sDevelopment/UnitOfWork.NET/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/Ar3sDevelopment/UnitOfWork.NET/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="business-framework" class="anchor" href="#business-framework" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Business Framework</h1>

<p><a href="https://gitter.im/Ar3sDevelopment/UnitOfWork.NET?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://badges.gitter.im/Join%20Chat.svg" alt="Join the chat at https://gitter.im/Ar3sDevelopment/UnitOfWork.NET"></a>
The UnitOfWork.NET NuGet Package <a href="http://badge.fury.io/nu/UnitOfWork.NET"><img src="https://badge.fury.io/nu/UnitOfWork.NET.svg" alt="NuGet version"></a></p>

<p>If you need support or you want to contact me I'm <a href="https://twitter.com/CaelanIt">CaelanIt</a> on Twitter</p>

<h2>
<a id="build" class="anchor" href="#build" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Build</h2>

<p>Travis CI (Mono): <a href="https://travis-ci.org/Ar3sDevelopment/UnitOfWork.NET"><img src="https://travis-ci.org/Ar3sDevelopment/UnitOfWork.NET.svg?branch=master" alt="Build Status"></a></p>

<p>AppVeyor (Windows): <a href="https://ci.appveyor.com/project/matteobruni/caelan-frameworks-biz"><img src="https://ci.appveyor.com/api/projects/status/arm3x6ls8vulmgin?svg=true" alt="Build status"></a></p>

<h2>
<a id="requests" class="anchor" href="#requests" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Requests</h2>

<p>Pull Requests: <a href="http://issuestats.com/github/Ar3sDevelopment/UnitOfWork.NET"><img src="http://issuestats.com/github/Ar3sDevelopment/UnitOfWork.NET/badge/pr" alt="Issue Stats"></a></p>

<p>Issues: <a href="http://issuestats.com/github/Ar3sDevelopment/UnitOfWork.NET"><img src="http://issuestats.com/github/Ar3sDevelopment/UnitOfWork.NET/badge/issue" alt="Issue Stats"></a></p>

<p>Waffle.io: <a href="https://waffle.io/Ar3sDevelopment/UnitOfWork.NET"><img src="https://badge.waffle.io/Ar3sDevelopment/UnitOfWork.NET.png?label=ready&amp;title=Ready" alt="Stories in Ready"></a></p>

<h2>
<a id="what-is-it" class="anchor" href="#what-is-it" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What is it?</h2>

<p>This package provides some utilities for the business layer like repositories and units of work.</p>

<h2>
<a id="irepository" class="anchor" href="#irepository" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>IRepository</code>
</h2>

<p>The <code>IRepository</code> interface is the base interface of Repositories used in this framework. It has two methods for getting the linked <code>IUnitOfWork</code> instance.
<code>IRepository</code> has two methods because you can get a generic <code>IUnitOfWork</code> or a custom <code>UnitOfWork</code> type.</p>

<h3>
<a id="repository" class="anchor" href="#repository" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>Repository</code>
</h3>

<p>The <code>Repository</code> class implements <code>IRepository</code> interface and has a static method for fluent notation for getting a <code>Repository&lt;TEntity, TDTO&gt;</code> specifying only <code>TEntity</code> and <code>TDTO</code>
This class is abstract because I thought that is useless for other uses.</p>

<h3>
<a id="irepositorytentity" class="anchor" href="#irepositorytentity" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>IRepository&lt;TEntity&gt;</code>
</h3>

<p>The <code>IRepository&lt;TEntity&gt;</code> interface inherits from <code>IRepository</code> and has more methods than its base and they're business related like basic CRUD operations.</p>

<h3>
<a id="irepositorytentity-tdto" class="anchor" href="#irepositorytentity-tdto" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>IRepository&lt;TEntity, TDTO&gt;</code>
</h3>

<p>The <code>IRepository&lt;TEntity, TDTO&gt;</code> interface inherits from <code>IRepository&lt;TEntity&gt;</code> and has more methods than its base and they're business related like basic CRUD operations.
<code>IRepository&lt;TEntity, TDTO&gt;</code> has also a method for return paginated result.</p>

<h4>
<a id="repositorytentity-tdto" class="anchor" href="#repositorytentity-tdto" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>Repository&lt;TEntity, TDTO&gt;</code>
</h4>

<p>The <code>Repository&lt;TEntity, TDTO&gt;</code> inherits from <code>Repository</code> and implements <code>IRepository&lt;TEntity, TDTO&gt;</code> interface with some <code>EntityFramework</code> code for doing CRUD operations.
If you need some custom methods you can inherit from <code>Repository&lt;TEntity, TDTO&gt;</code> and use all the business ready methods.
Supposing you need a method to get if a user is admin:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-c">//Custom `Repository` implemetation class</span>
<span class="pl-k">public</span> <span class="pl-k">bool</span> IsAdmin(<span class="pl-k">int</span> id)
{
  <span class="pl-k">var</span> user = SingleEntity(id);
  <span class="pl-k">return</span> user != <span class="pl-c1">null</span> ? user.Admin : <span class="pl-c1">false</span>;
}</pre></div>

<p>Or if you need a method that return all admin users:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-c">//Custom `Repository` implemetation class</span>
<span class="pl-k">public</span> IEnumerable&lt;UserDTO&gt; AllAdmins()
{
  <span class="pl-k">return</span> List(t =&gt; t.Admin); <span class="pl-c">//DTOs</span>
}

<span class="pl-k">public</span> IEnumerable&lt;User&gt; AllAdminsEntities()
{
  <span class="pl-k">return</span> All(t =&gt; t.Admin);
}

<span class="pl-c">//using builders from my Common Framework</span>
<span class="pl-k">public</span> IEnumerable&lt;UserDTO&gt; AllAdminsEntitiesDTO()
{
  <span class="pl-k">return</span> DTOBuilder().BuildList(AllAdminsEntities());
}</pre></div>

<p>Last solution is preferred because you can methods that returns subset of records and when you need DTOs you can simply build them with provided <code>Builder</code>s methods: <code>DTOBuilder()</code> for Entity to DTO mappings and <code>EntityBuilder()</code> for DTO to Entity mappings.
They use <code>Builder</code> class from my Common framework.</p>

<p>The paginated result uses method All with pagination parameters. It returns a <code>DataSourceResult</code>, that can also be used in WCF, with the page record and the total. <code>Sort</code> and <code>Filter</code> classes are in my DynamicLinq framework and contains data for sorting and filtering data for the page you need.</p>

<h4>
<a id="accessing-to-other-repository-from-current" class="anchor" href="#accessing-to-other-repository-from-current" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Accessing to other <code>Repository</code> from current</h4>

<p>If you need to use another <code>Repository</code> while doing operation in a <code>Repository</code> you can use the <code>UnitOfWork</code> method for going to container and access to other repositories like explained later.
Here an example:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">bool</span> CheckLogin(<span class="pl-k">string</span> username, <span class="pl-k">string</span> password)
{
  <span class="pl-k">var</span> user = Single(t =&gt; t.Username == username &amp;&amp; t.Password == passowrd); <span class="pl-c">//not secure!!</span>
  <span class="pl-k">var</span> res = user != <span class="pl-c1">null</span>;

  <span class="pl-k">if</span> (res)
  {
    <span class="pl-k">var</span> access = <span class="pl-k">new</span> UserAccessDTO { IDUser = user.ID, Date = DateTime.Now };
    UnitOfWork().Repository&lt;UserAccess, UserAccessDTO&gt;().Insert(access);
  }

  <span class="pl-k">return</span> res;
}</pre></div>

<p>With this code you can log a user access without leaving <code>UserRepository</code> class and delegate this to the caller method.
Remember to keep <code>Repository</code> methods simple and without doing action out of their scope.</p>

<h4>
<a id="ilistrepositorytentity-tdto-tlistdto" class="anchor" href="#ilistrepositorytentity-tdto-tlistdto" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>IListRepository&lt;TEntity, TDTO, TListDTO&gt;</code>
</h4>

<p>The <code>IListRepository&lt;TEntity, TDTO, TListDTO&gt;</code> is an interface that inherits from <code>IRepository&lt;TEntity, TDTO&gt;</code> and has only one get-set property for another <code>IRepository</code> but for <code>TEntity</code> and <code>TListDTO</code> so you can have two DTO for the same type, one lighter for reading lists of DTOs and one complete for CRUD operations.
I use it when I have to return data using WCF and data must navigate deep inside objects.</p>

<h2>
<a id="iunitofwork" class="anchor" href="#iunitofwork" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>IUnitOfWork</code>
</h2>

<p>The <code>IUnitOfWork</code> interface contains base methods for the <code>UnitOfWork</code> like transactions, save changes and getting repositories.</p>

<h3>
<a id="unitofwork" class="anchor" href="#unitofwork" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>UnitOfWork</code>
</h3>

<p>There are two <code>UnitOfWork</code> classes, one wants <code>DbContext</code> in constructor, the other inherits from this and wants only the <code>DbContext</code> type and instantiate it with default constructor.
<code>UnitOfWork</code> implements the <code>IDisposable</code> interface so you can use it in the <code>using</code> closure and it disposes the context only if it's instatiated by the <code>UnitOfWork</code> otherwise you will be responsible for it.
<code>UnitOfWork</code> class, like <code>Builder</code>, uses reflection for getting <code>IRepository</code> objects that are unknown. You can get the repository in two ways:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> (var uow = new UnitOfWork&lt;TestDbContext&gt;()) //the uow object is responsible for disposing the context
{
  <span class="pl-k">const</span> <span class="pl-k">int</span> id = <span class="pl-c1">1</span>;
  <span class="pl-k">var</span> user = uow.Repository&lt;User, UserDTO&gt;().SingleDTO(id);
  <span class="pl-k">if</span> (user != <span class="pl-c1">null</span> &amp;&amp; uow.CustomRepository&lt;UserRepository&gt;().IsAdmin(user.Id))
  {
    <span class="pl-c">//user is admin</span>
  }
  <span class="pl-k">else</span> <span class="pl-k">if</span> (user != <span class="pl-c1">null</span>)
  {
    <span class="pl-c">//user exists but is not admin</span>
  }
  <span class="pl-k">else</span>
  {
    <span class="pl-c">//user not found</span>
  }
}</pre></div>

<p>The <code>user</code> object is retrieved by <code>IRepository&lt;TEntity, TDTO&gt;</code> exposed methods because the repository type is not known at compile time. We can check the admin status by retrieving the repository by type so we know it at compile time and we can use its business related methods like <code>IsAdmin</code>.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Business Framework maintained by <a href="https://github.com/Ar3sDevelopment">Ar3sDevelopment</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-57981518-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
